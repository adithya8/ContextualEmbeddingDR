#! /bin/bash
msg=(16 32 64 128 256 512 1024 2048)
arraylength=${#msg[@]}
for (( i=1; i<${arraylength}+1; i++ ));
do
    # Running Auto Encoder for Dimensionality Reduction

    echo "----------------------------------------------------------------------"
    echo "Running BERT for FFAE with Message ${msg[$i-1]}"
    echo "----------------------------------------------------------------------"
    echo "Running auto encoder on task_A table"
    python3 ./auto_encoder.py "feat\$bert_ba_un_memimaL10co\$tr_a11essays\$clp18_id\$16to16.csv_dense.csv" "feat\$bert_ba_un_memimaL10co\$te_a11essays\$clp18_id\$16to16.csv_dense.csv" ${msg[$i-1]} 
    

    # Putting into database the tables generated by auto encoder
    # feat$bert_ba_un_memimaL10co$task_A$user_id$16to16_ffae.csv
    python ./csv2mySQL.py /users2/aravula/ffae_results/clp18/feat\$bert_ba_un_memimaL10co\$tr_a11essays\$clp18_id\$16to16_ffae.csv clp18_adi feat\$bert_ba_un_memimaL10co\$tr_a11essays\$clp18_id_ffae '(id bigint(16) unsigned, group_id varchar(16), feat varchar(12), value int(11), group_norm double)' 1
    python ./csv2mySQL.py /users2/aravula/ffae_results/clp18/feat\$bert_ba_un_memimaL10co\$te_a11essays\$clp18_id\$16to16_ffae.csv clp18_adi feat\$bert_ba_un_memimaL10co\$te_a11essays\$clp18_id_ffae '(id bigint(16) unsigned, group_id varchar(16), feat varchar(12), value int(11), group_norm double)' 1

    /users2/aravula/dlatk/dlatkInterface.py -d clp18_adi -t tr_a11essays -c clp18_id --group_freq_thresh 0 -f 'feat$bert_ba_un_memimaL10co$tr_a11essays$clp18_id_ffae' --outcome_table tr_variables --outcomes a11_bsag_total --output_name a11_bsag_total_output --combo_test_reg --model ridgehighcv --folds 10
    /users2/aravula/dlatk/dlatkInterface.py -d clp18_adi -t tr_a11essays -c clp18_id --group_freq_thresh 0 -f 'feat$bert_ba_un_memimaL10co$tr_a11essays$clp18_id_ffae' --outcome_table tr_variables --outcomes a11_bsag_total --train_regression --model ridge10 --save_model --picklefile /data/aravula/ffae_results/bert_ffae_${msg[$i-1]}_clp18.pickle
    /users2/aravula/dlatk/dlatkInterface.py -d clp18_adi -t te_a11essays -c clp18_id --group_freq_thresh 0 -f 'feat$bert_ba_un_memimaL10co$te_a11essays$clp18_id_ffae' --predict_regression_to_outcome_table bert_kmeans_16_clp18_ridge10_a11_bsag_total --load --picklefile /data/aravula/ffae_results/bert_ffae_${msg[$i-1]}_clp18.pickle --outcome_table te_a11essays_labels --outcomes a11_bsag_total  --predict_regression --model ridge10 >> /data/aravula/ffae_results/bert_ffae_${msg[$i-1]}_clp18.txt
   
done